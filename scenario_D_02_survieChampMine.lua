--Name : Champs de mine

function init()
    player = PlayerSpaceship():setFaction("Vindh"):setTemplate("VCorvette"):setCallSign("Camarade"):setPosition(11900, 7600);
    player:setHull(250)
    player:setShields(200,200)
    player:setRepairCrewCount(0);
    player:commandAddWaypoint(30033, -5021);
    player:commandAddWaypoint(57317, -13281);

    generateMinefield(7500,-5000,10,10) 
    generateMinefield(35000,-15000,10,10) 

    generateMobs(4, "MT52 Hornet", "Charognards", 45000, 6688, 2000, function(mob) mob:orderAttack(player) end);
    generateMobs(4, "MT52 Hornet", "Charognards", 28548, -21186, 2000, function(mob) mob:orderAttack(player) end);

    Nebula():setPosition(45003, 6688)
    Nebula():setPosition(28548, -21186)
    SupplyDrop():setFaction("Vindh"):setPosition(30033, -5021):setEnergy(500):setWeaponStorage("Homing", 4):setWeaponStorage("Nuke", 1):setWeaponStorage("Mine", 2):setWeaponStorage("EMP", 1)
    station = SpaceStation():setTemplate("Medium Station"):setFaction("Independent"):setCallSign("DS15037"):setPosition(57317, -13281)

    station:sendCommsMessage(player, "Vous etes scrap, votre ingenieur est mort. Venez me voir au cadran E7 pour une r√©paration d'urgence. Je remarque des aussi des ressources au cadron E6");

    Asteroid():setPosition(48538, 17141)
    Asteroid():setPosition(48690, 17345)
    Asteroid():setPosition(47858, 19236)
    Asteroid():setPosition(48201, 19000)
    Asteroid():setPosition(49017, 18925)
    Asteroid():setPosition(48845, 18111)
    Asteroid():setPosition(46660, 18274)
    Asteroid():setPosition(45656, 18167)
    Asteroid():setPosition(46423, 17103)
    Asteroid():setPosition(48824, 15021)
    Asteroid():setPosition(48021, 15088)
    Asteroid():setPosition(45857, 15096)
    Asteroid():setPosition(45579, 15880)
    Asteroid():setPosition(49400, 17808)
    Asteroid():setPosition(49572, 16266)
    Asteroid():setPosition(43893, 6804)
    Asteroid():setPosition(43495, 6301)
    Asteroid():setPosition(45106, 13311)
    Asteroid():setPosition(35880, 89)
    Asteroid():setPosition(35902, 263)
    Asteroid():setPosition(38173, 1675)
    Asteroid():setPosition(44404, 10412)
    Asteroid():setPosition(49068, 12456)
    Asteroid():setPosition(46959, 12149) Asteroid():setPosition(45370, 12491)
    Asteroid():setPosition(42927, 6395)
    Asteroid():setPosition(40977, 10842)
    Asteroid():setPosition(39703, 8508)
    Asteroid():setPosition(39939, 9336)
    Asteroid():setPosition(47766, 1128)
    Asteroid():setPosition(48927, -15)
    Asteroid():setPosition(38184, -824)
    Asteroid():setPosition(37428, -1277)
    Asteroid():setPosition(43448, 3213)
    Asteroid():setPosition(38912, 3316)
    Asteroid():setPosition(43744, 15986)
    Asteroid():setPosition(42437, 17751)
    Asteroid():setPosition(41085, 15847)
    Asteroid():setPosition(39220, 13191)
    Asteroid():setPosition(38697, 15096)
    Asteroid():setPosition(32850, 16178)
    Asteroid():setPosition(35427, 14981)
    Asteroid():setPosition(36529, 16438)
    Asteroid():setPosition(36358, 12766)
    Asteroid():setPosition(29315, 8233)
    Asteroid():setPosition(30430, 8754)
    Asteroid():setPosition(36446, 9488)
    Asteroid():setPosition(41553, 20947)
    Asteroid():setPosition(40580, 20030)
    Asteroid():setPosition(40050, 20151)
    Asteroid():setPosition(45182, 20197)
    Asteroid():setPosition(43031, 20887)
    Asteroid():setPosition(38576, 20079)
    Asteroid():setPosition(36008, 20896)
    Asteroid():setPosition(27717, 9675)
    Asteroid():setPosition(27842, 12525)
    Asteroid():setPosition(26825, 6837)
    Asteroid():setPosition(31177, 10410)
    Asteroid():setPosition(31037, 10108)
    Asteroid():setPosition(29374, 20958)
    Asteroid():setPosition(29648, 17088)
    Asteroid():setPosition(26643, 18195)
    Asteroid():setPosition(26284, 17198)
    Asteroid():setPosition(45357, 2020)
    Asteroid():setPosition(47607, 2272)
    Asteroid():setPosition(49699, 1648)
    Asteroid():setPosition(48607, 1965)
    Asteroid():setPosition(40741, 1511)
    Asteroid():setPosition(45260, 9585)
    Asteroid():setPosition(44848, 9952)
    Asteroid():setPosition(43801, 6577)
    Asteroid():setPosition(37284, 2239)
    Asteroid():setPosition(37034, 1424)
    Asteroid():setPosition(30044, 23427)
    Asteroid():setPosition(30516, 24438)
    Asteroid():setPosition(29172, 23011)
    Asteroid():setPosition(31644, 27893)
    Asteroid():setPosition(31560, 25422)
    Asteroid():setPosition(27809, 23876)
    Asteroid():setPosition(27897, 24332)
    Asteroid():setPosition(28186, 22761)
    Asteroid():setPosition(27314, 23808)
    Asteroid():setPosition(35599, 24676)
    Asteroid():setPosition(32979, 22122)
    Asteroid():setPosition(38882, 23511)
    Asteroid():setPosition(40553, 24257)
    Asteroid():setPosition(35907, 26541)
    Asteroid():setPosition(36789, 26440)
    Asteroid():setPosition(39425, 25734)
    Asteroid():setPosition(43227, 22609)
    Asteroid():setPosition(45498, 22563)
    Asteroid():setPosition(50290, 18855)
    Asteroid():setPosition(39735, 7703)
    Asteroid():setPosition(41166, 7503)
    Asteroid():setPosition(42464, 7566)
    Asteroid():setPosition(45152, 4820)
    Asteroid():setPosition(44418, 4764)
    Asteroid():setPosition(41780, 2900)
    Asteroid():setPosition(42384, 4382)
    Asteroid():setPosition(43045, 22145)
    Asteroid():setPosition(43260, 15654)
    Asteroid():setPosition(43326, 15060)
    Asteroid():setPosition(41225, 17300)
    Asteroid():setPosition(42536, 17365)
    Asteroid():setPosition(34837, 20444)
    Asteroid():setPosition(36958, 18400)
    Asteroid():setPosition(41573, 16265)
    Asteroid():setPosition(40189, 16510)
    Asteroid():setPosition(22199, 11330)
    Asteroid():setPosition(20868, 1504)
    Asteroid():setPosition(25279, 6485)
    Asteroid():setPosition(25861, 9986)
    Asteroid():setPosition(26028, 12543)
    Asteroid():setPosition(19105, 5299)
    Asteroid():setPosition(21639, 5335)
    Asteroid():setPosition(20611, 3437)
    Asteroid():setPosition(24754, 1020)
    Asteroid():setPosition(24909, 2820)
    Asteroid():setPosition(10611, 4796)
    Asteroid():setPosition(9555, 3900)
    Asteroid():setPosition(13651, 742)
    Asteroid():setPosition(11423, 3278)
    Asteroid():setPosition(9294, 3266)
    Asteroid():setPosition(17352, 3126)
    Asteroid():setPosition(15530, 8358)
    Asteroid():setPosition(16654, 7639)
    Asteroid():setPosition(17233, 7926)
    Asteroid():setPosition(20416, 10506)
    Asteroid():setPosition(18663, 10944)
    Asteroid():setPosition(16108, 10334)
    Asteroid():setPosition(16223, 11255)
    Asteroid():setPosition(30890, 19250)
    Asteroid():setPosition(31713, 20133)
    Asteroid():setPosition(28204, 18968)
    Asteroid():setPosition(25770, 19937)
    Asteroid():setPosition(27561, 19709)
    Asteroid():setPosition(16053, 20801)
    Asteroid():setPosition(15162, 12911)
    Asteroid():setPosition(18046, 14849)
    Asteroid():setPosition(17620, 15981)
    Asteroid():setPosition(20932, 14612)
    Asteroid():setPosition(21121, 13484)
    Asteroid():setPosition(33164, 440)
    Asteroid():setPosition(34675, 2682)
    Asteroid():setPosition(28011, 1974)
    Asteroid():setPosition(27259, -1598)
    Asteroid():setPosition(28047, -470)
    Asteroid():setPosition(29016, -44)
    Asteroid():setPosition(31246, -1573)
    Asteroid():setPosition(30817, 767)
    Asteroid():setPosition(16029, 4226)
    Asteroid():setPosition(20085, 4018)
    Asteroid():setPosition(28468, 7110)
    Asteroid():setPosition(28479, 7360)
    Asteroid():setPosition(27487, 7161)
    Asteroid():setPosition(27188, 5927)
    Asteroid():setPosition(26064, 5855)
    Asteroid():setPosition(26703, 6425)
    Asteroid():setPosition(23104, 10426)
    Asteroid():setPosition(25367, 9040)
    Asteroid():setPosition(27431, 16627)
    Asteroid():setPosition(23121, 16246)
    Asteroid():setPosition(22691, 16563)
    Asteroid():setPosition(33052, 12923)
    Asteroid():setPosition(32168, 9244)
    Asteroid():setPosition(31878, 8517)
    Asteroid():setPosition(29817, 5465)
    Asteroid():setPosition(34329, 7106)
    Asteroid():setPosition(36888, 5799)
    Asteroid():setPosition(35589, 7652)
    Asteroid():setPosition(17676, 1116)
    Asteroid():setPosition(27901, 3935)
    Asteroid():setPosition(31300, 4041)
    Asteroid():setPosition(26343, -202)
    Asteroid():setPosition(25513, 624)
    Asteroid():setPosition(31910, 7339)
    Asteroid():setPosition(33824, 7420)
    Asteroid():setPosition(33143, 4921)
    Asteroid():setPosition(33819, 4796)
    Asteroid():setPosition(26906, 5312)
    Asteroid():setPosition(28997, 4773)
    Asteroid():setPosition(22883, 344)
    Asteroid():setPosition(23728, 8)
    Asteroid():setPosition(22586, -1785)
    Asteroid():setPosition(23876, -846)
    Asteroid():setPosition(18386, -698)
    Asteroid():setPosition(19740, -1316)
    Asteroid():setPosition(12160, 872)
    Asteroid():setPosition(14751, -763)
    Asteroid():setPosition(15654, -764)
    Asteroid():setPosition(10260, 820)
    Asteroid():setPosition(12050, 87)
    Asteroid():setPosition(35328, -1823)
    Asteroid():setPosition(33489, -2474)
    Asteroid():setPosition(37650, -2060)
    Asteroid():setPosition(31514, -2415)
    Asteroid():setPosition(34609, -2756)
    Asteroid():setPosition(32747, -2768)
    Asteroid():setPosition(31395, -2544)
    Asteroid():setPosition(29366, -2822)
    Asteroid():setPosition(30213, -2928)
    Asteroid():setPosition(10464, -3196)
    Asteroid():setPosition(12720, -2585)
    Asteroid():setPosition(12337, -2267)
    Asteroid():setPosition(51997, 15435)
    Asteroid():setPosition(55138, 600)
    Asteroid():setPosition(53631, 718)
    Asteroid():setPosition(25873, 24054)
    Asteroid():setPosition(25584, 26291)
    Asteroid():setPosition(53763, -2820)
    Asteroid():setPosition(24902, 26913)
    Asteroid():setPosition(25689, 26920)
    Asteroid():setPosition(23406, -7861)
    Asteroid():setPosition(24143, -9228)
    Asteroid():setPosition(23720, -4081)
    Asteroid():setPosition(24572, -5236)
    Asteroid():setPosition(24677, -5104)
    Asteroid():setPosition(23140, -12361)
    Asteroid():setPosition(23657, -13251)
    Asteroid():setPosition(21473, -13461)
    Asteroid():setPosition(20424, -16040)
    Asteroid():setPosition(21963, -18035)
    Asteroid():setPosition(20127, -8701)
    Asteroid():setPosition(17906, -5629)
    Asteroid():setPosition(20616, -5459)
    Asteroid():setPosition(20962, -5075)
    Asteroid():setPosition(646, -22144)
    Asteroid():setPosition(840, -21233)
    Asteroid():setPosition(89, -21485)
    Asteroid():setPosition(4514, -23453)
    Asteroid():setPosition(3749, -24293)
    Asteroid():setPosition(6496, -20306)
    Asteroid():setPosition(2931, -21155)
    Asteroid():setPosition(6150, -24333)
    Asteroid():setPosition(5557, -24786)
    Asteroid():setPosition(15203, -28796)
    Asteroid():setPosition(15466, -29147)
    Asteroid():setPosition(15814, -28383)
    Asteroid():setPosition(18078, -31021)
    Asteroid():setPosition(8477, -26054)
    Asteroid():setPosition(8028, -26460)
    Asteroid():setPosition(7613, -29453)
    Asteroid():setPosition(6038, -26675)
    Asteroid():setPosition(13874, -25634)
    Asteroid():setPosition(11660, -27295)
    Asteroid():setPosition(10080, -27215)
    Asteroid():setPosition(10672, -23238)
    Asteroid():setPosition(10819, -23729)
    Asteroid():setPosition(8997, -24521)
    Asteroid():setPosition(9257, -23521)
    Asteroid():setPosition(9784, -21884)
    Asteroid():setPosition(9047, -23290)
    Asteroid():setPosition(10435, -19388)
    Asteroid():setPosition(10666, -21344)
    Asteroid():setPosition(18700, -24641)
    Asteroid():setPosition(15916, -24043)
    Asteroid():setPosition(16668, -17416)
    Asteroid():setPosition(17244, -18195)
    Asteroid():setPosition(17534, -27974)
    Asteroid():setPosition(17324, -27308)
    Asteroid():setPosition(14695, -24342)
    Asteroid():setPosition(16873, -24106)
    Asteroid():setPosition(13981, -20044)
    Asteroid():setPosition(13102, -19529)
    Asteroid():setPosition(12760, -19256)
    Asteroid():setPosition(16132, -19397)
    Asteroid():setPosition(22099, -19743)
    Asteroid():setPosition(19722, -19794)
    Asteroid():setPosition(19876, -19591)
    Asteroid():setPosition(18800, -19737)
    Asteroid():setPosition(18800, -23214)
    Asteroid():setPosition(20250, -22397)
    Asteroid():setPosition(21506, -21813)
    Asteroid():setPosition(27722, -30606)
    Asteroid():setPosition(27822, -28916)
    Asteroid():setPosition(24344, -29884)
    Asteroid():setPosition(26182, -28828)
    Asteroid():setPosition(26534, -20265)
    Asteroid():setPosition(27292, -18515)
    Asteroid():setPosition(24855, -21460)
    Asteroid():setPosition(32146, -20309)
    Asteroid():setPosition(32150, -20838)
    Asteroid():setPosition(13631, -11315)
    Asteroid():setPosition(14218, -10072)
    Asteroid():setPosition(14851, -12538)
    Asteroid():setPosition(15326, -12064)
    Asteroid():setPosition(15384, -13105)
    Asteroid():setPosition(13947, -17485)
    Asteroid():setPosition(13264, -16298)
    Asteroid():setPosition(13033, -14861)
    Asteroid():setPosition(8805, -19662)
    Asteroid():setPosition(11352, -17800)
    Asteroid():setPosition(10638, -15474)
    Asteroid():setPosition(8754, -14133)
    Asteroid():setPosition(9284, -14132)
    Asteroid():setPosition(8581, -13174)
    Asteroid():setPosition(8601, -9359)
    Asteroid():setPosition(11106, -11332)
    Asteroid():setPosition(12979, -12868)
    Asteroid():setPosition(12742, -12979)
    Asteroid():setPosition(14985, -5071)
    Asteroid():setPosition(15011, -3781)
    Asteroid():setPosition(15989, -7923)
    Asteroid():setPosition(12707, -8280)
    Asteroid():setPosition(13833, -8739)
    Asteroid():setPosition(11235, -8631)
    Asteroid():setPosition(14825, -9812)
    Asteroid():setPosition(16854, -4556)
    Asteroid():setPosition(17208, -3704)
    Asteroid():setPosition(60342, -2914)
    Asteroid():setPosition(57920, 2925)
    Asteroid():setPosition(56003, 886)
    Asteroid():setPosition(65770, -27)
    Asteroid():setPosition(62342, 1146)
    Asteroid():setPosition(62540, 575)
    Asteroid():setPosition(12933, -5249)
    Asteroid():setPosition(12598, -4825)
    Asteroid():setPosition(13101, -4310)
    Asteroid():setPosition(28090, -25623)
    Asteroid():setPosition(29987, -25421)
    Asteroid():setPosition(31299, -23672)
    Asteroid():setPosition(30222, -21188)
    Asteroid():setPosition(27846, -21915)
    Asteroid():setPosition(25570, -25603)
    Asteroid():setPosition(25462, -23400)
    Asteroid():setPosition(26022, -21295)
    Asteroid():setPosition(33376, -20674)
    Asteroid():setPosition(32170, -18945)
    Asteroid():setPosition(36018, -17406)
    Asteroid():setPosition(33824, -18063)
    Asteroid():setPosition(26458, -18204)
    Asteroid():setPosition(21052, -25243)
    Asteroid():setPosition(24130, -25159)
    Asteroid():setPosition(24250, -23287)
    Asteroid():setPosition(22197, -23304)
    Asteroid():setPosition(27759, -8814)
    Asteroid():setPosition(26114, -9396)
    Asteroid():setPosition(27860, -13460)
    Asteroid():setPosition(27265, -14037)
    Asteroid():setPosition(23563, -24076)
    Asteroid():setPosition(20310, -27415)
    Asteroid():setPosition(35938, -24651)
    Asteroid():setPosition(36417, -24402)
    Asteroid():setPosition(37042, -24543)
    Asteroid():setPosition(37114, -18802)
    Asteroid():setPosition(36383, -20737)
    Asteroid():setPosition(37181, -23602)
    Asteroid():setPosition(38390, -24616)
    Asteroid():setPosition(38808, -24112)
    Asteroid():setPosition(39043, -24377)
    Asteroid():setPosition(40199, -25267)
    Asteroid():setPosition(40536, -24257)
    Asteroid():setPosition(37255, -23978)
    Asteroid():setPosition(36855, -25183)
    Asteroid():setPosition(34101, -23627)
    Asteroid():setPosition(34288, -24239)
    Asteroid():setPosition(35063, -23195)
    Asteroid():setPosition(34516, -22796)
    Asteroid():setPosition(38820, -4286)
    Asteroid():setPosition(36864, -5217)
    Asteroid():setPosition(35328, -5363)
    Asteroid():setPosition(23731, -10267)
    Asteroid():setPosition(22755, -8794)
    Asteroid():setPosition(21185, -15038)
    Asteroid():setPosition(21691, -14105)
    Asteroid():setPosition(25408, -15410)
    Asteroid():setPosition(20720, -11561)
    Asteroid():setPosition(18645, -9035)
    Asteroid():setPosition(18278, -12529)
    Asteroid():setPosition(18141, -15220)
    Asteroid():setPosition(17561, -10847)
    Asteroid():setPosition(19735, -9377)
    Asteroid():setPosition(17715, -9145)
    Asteroid():setPosition(34830, -6116)
    Asteroid():setPosition(29833, -14429)
    Asteroid():setPosition(29153, -14259)
    Asteroid():setPosition(29109, -13344)
    Asteroid():setPosition(29419, -16743)
    Asteroid():setPosition(30903, -11884)
    Asteroid():setPosition(31024, -11047)
    Asteroid():setPosition(32653, -11067)
    Asteroid():setPosition(32031, -12487)
    Asteroid():setPosition(34869, -15497)
    Asteroid():setPosition(28338, -17297)
    Asteroid():setPosition(32555, -4045)
    Asteroid():setPosition(31660, -9938)
    Asteroid():setPosition(31369, -9023)
    Asteroid():setPosition(30515, -9375)
    Asteroid():setPosition(33644, -10386)
    Asteroid():setPosition(34115, -9394)
    Asteroid():setPosition(28255, -8576)
    Asteroid():setPosition(28613, -8030)
    Asteroid():setPosition(28883, -7140)
    Asteroid():setPosition(19779, -3728)
    Asteroid():setPosition(21681, -16773)
end

function update()
    player:setSystemHealth("Maneuver", 0.95);
    player:setSystemHealth("BeamWeapons", 0.84);
    player:setSystemHealth("RearShield", 0.43);
    player:setSystemHealth("Reactor", 0.78);
    player:setSystemHealth("JumpDrive", -1.0);
    player:setSystemHealth("FrontShield", 0.88);
    player:setSystemHealth("Impulse", 0.9);
    player:setSystemHealth("MissileSystem", 0.3);

    if player:isDocked(station) then
        victory("Vindh");
    end
    if not player:isValid() then
        victory("Charognards");
    end
end

-- Will generate a structured minefield x and y are top left the width and height are in mine numbers
function generateMinefield(x, y, width, height)
    for i=0, width - 1,1 do
        for j=0, height - 1,1 do
            local offset = j % 2 * 1000
            Mine():setPosition(x + i * 2000 + offset,y + j * 2000);
        end
    end
end

function generateMobs(nb, template, faction, centerX, centerY, radius, fn)
    local mobs = {};

    for i=1, nb, 1 do
        local mob = CpuShip():setFaction(faction):setTemplate(template):setCallSign(srandom(irandom(2,3)) .. irandom(10,999)):setPosition(irandom(centerX - radius, centerX + radius), irandom(centerY - radius, centerY + radius))
        fn(mob);
        table.insert(mobs, mob);
    end

    return mobs;
end

charset = {}
-- QWERTYUIOPASDFGHJKL tZXCVBNM
for i = 65,  90 do table.insert(charset, string.char(i)) end

function srandom(length)
  if length > 0 then
    return srandom(length - 1) .. charset[irandom(1, #charset)]
  else
    return ""
  end
end
