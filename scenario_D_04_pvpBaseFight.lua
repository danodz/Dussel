--Name : base fight
function init()
    BlackHole():setPosition(236, 788)
    Asteroid():setPosition(-46829, 17480)
    Asteroid():setPosition(-42087, 18022)
    Asteroid():setPosition(-42900, 17886)
    Asteroid():setPosition(-43035, 18022)
    Asteroid():setPosition(-36396, 17751)
    Asteroid():setPosition(-37480, 16396)
    Asteroid():setPosition(-38564, 15718)
    Asteroid():setPosition(-39919, 15718)
    Asteroid():setPosition(-39648, 9350)
    Asteroid():setPosition(-35718, 10569)
    Asteroid():setPosition(-33415, 14228)
    Asteroid():setPosition(-33686, 18022)
    Asteroid():setPosition(-35583, 15718)
    Asteroid():setPosition(-35176, 12602)
    Asteroid():setPosition(-39512, 13957)
    Asteroid():setPosition(-30976, 18835)
    Asteroid():setPosition(-35447, 22900)
    Asteroid():setPosition(-30840, 17886)
    Asteroid():setPosition(-49268, 19783)
    Asteroid():setPosition(-31518, 20596)
    Asteroid():setPosition(-39241, 20461)
    Asteroid():setPosition(-31924, 11653)
    Asteroid():setPosition(-32195, 12195)
    Asteroid():setPosition(-37615, 9621)
    Asteroid():setPosition(-29756, 18022)
    Asteroid():setPosition(-30434, 21545)
    Asteroid():setPosition(-34092, 22358)
    Asteroid():setPosition(-29350, 17480)
    Asteroid():setPosition(-30569, 14363)
    Asteroid():setPosition(-29756, 12195)
    Asteroid():setPosition(-28943, 17480)
    Asteroid():setPosition(-28130, 16125)
    Asteroid():setPosition(-27046, 15447)
    Asteroid():setPosition(-28537, 12331)
    Asteroid():setPosition(-26369, 13550)
    Asteroid():setPosition(-26098, 16667)
    Asteroid():setPosition(-31789, 18293)
    Asteroid():setPosition(-32873, 17886)
    Asteroid():setPosition(-37073, 9079)
    Asteroid():setPosition(-30027, 5962)
    Asteroid():setPosition(-27724, 9079)
    Asteroid():setPosition(-32466, 7046)
    Asteroid():setPosition(-25691, 10434)
    Asteroid():setPosition(-29485, 8943)
    Asteroid():setPosition(-19187, 14905)
    Asteroid():setPosition(-21626, 18293)
    Asteroid():setPosition(-18509, 8266)
    Asteroid():setPosition(-23930, 19377)
    Asteroid():setPosition(-20813, 9485)
    Asteroid():setPosition(-25556, 6911)
    Asteroid():setPosition(-27724, 2439)
    Asteroid():setPosition(-22710, 14363)
    Asteroid():setPosition(-22710, 12331)
    Asteroid():setPosition(-27182, 4065)
    Asteroid():setPosition(-19322, 24797)
    Asteroid():setPosition(-25149, 24390)
    Asteroid():setPosition(-34499, 25068)
    Asteroid():setPosition(-23930, 18970)
    Asteroid():setPosition(-22304, 18428)
    Asteroid():setPosition(-21897, 19241)
    Asteroid():setPosition(-24607, 22222)
    Asteroid():setPosition(-12547, 20867)
    Asteroid():setPosition(-15528, 15718)
    Asteroid():setPosition(-16883, 10976)
    Asteroid():setPosition(-19051, 15718)
    Asteroid():setPosition(-15528, 16667)
    Asteroid():setPosition(-18374, 23984)
    Asteroid():setPosition(-18780, 23577)
    Asteroid():setPosition(-25691, 34011)
    Asteroid():setPosition(-29892, 34011)
    Asteroid():setPosition(-39648, 26829)
    Asteroid():setPosition(-43171, 22493)
    Asteroid():setPosition(-28943, 28591)
    Asteroid():setPosition(-32195, 29268)
    Asteroid():setPosition(-33821, 29404)
    Asteroid():setPosition(-30434, 24797)
    Asteroid():setPosition(-29756, 27642)
    Asteroid():setPosition(-27317, 24119)
    Asteroid():setPosition(-27182, 23035)
    Asteroid():setPosition(-26233, 19377)
    Asteroid():setPosition(-29214, 22358)
    Asteroid():setPosition(-26098, 28184)
    Asteroid():setPosition(-23523, 31978)
    Asteroid():setPosition(-21762, 26965)
    Asteroid():setPosition(-21626, 24390)
    Asteroid():setPosition(-25014, 26152)
    Asteroid():setPosition(-23252, 28049)
    Asteroid():setPosition(-20271, 29946)
    Asteroid():setPosition(-17696, 26287)
    Asteroid():setPosition(-17696, 26287)
    Asteroid():setPosition(-13631, 27100)
    Asteroid():setPosition(-21084, 27100)
    Asteroid():setPosition(-18374, 27507)
    Asteroid():setPosition(-12412, 27642)
    Asteroid():setPosition(-11463, 23035)
    Asteroid():setPosition(-11057, 22087)
    Asteroid():setPosition(-7263, 15176)
    Asteroid():setPosition(-7669, 12195)
    Asteroid():setPosition(-12276, 13821)
    Asteroid():setPosition(-12276, 15854)
    Asteroid():setPosition(-17425, 15176)
    Asteroid():setPosition(-19187, 9079)
    Asteroid():setPosition(-20406, 7859)
    Asteroid():setPosition(-23930, 7588)
    Asteroid():setPosition(-23523, 13279)
    Asteroid():setPosition(-16070, 21545)
    Asteroid():setPosition(-16070, 25610)
    Asteroid():setPosition(-16070, 26016)
    Asteroid():setPosition(-11328, 21409)
    Asteroid():setPosition(-10108, 19919)
    Asteroid():setPosition(-8347, 18564)
    Asteroid():setPosition(-7669, 25339)
    Asteroid():setPosition(-6179, 29404)
    Asteroid():setPosition(-8347, 32249)
    Asteroid():setPosition(-13089, 32385)
    Asteroid():setPosition(-20542, 35366)
    Asteroid():setPosition(-24472, 35230)
    Asteroid():setPosition(-25014, 33198)
    Asteroid():setPosition(-22033, 32385)
    Asteroid():setPosition(-18645, 32249)
    Asteroid():setPosition(-16070, 30352)
    Asteroid():setPosition(-15528, 28184)
    Asteroid():setPosition(-18645, 29133)
    Asteroid():setPosition(-15799, 32520)
    Asteroid():setPosition(-17019, 34824)
    Asteroid():setPosition(-15257, 34146)
    Asteroid():setPosition(-10650, 30217)
    Asteroid():setPosition(-11192, 26694)
    Asteroid():setPosition(-9973, 26423)
    Asteroid():setPosition(-9702, 28184)
    Asteroid():setPosition(-13360, 35366)
    Asteroid():setPosition(-13631, 35230)
    Asteroid():setPosition(-13631, 35230)
    Asteroid():setPosition(-21762, 38482)
    Asteroid():setPosition(-16883, 33875)
    Asteroid():setPosition(-15528, 32791)
    Asteroid():setPosition(-17561, 36043)
    Asteroid():setPosition(-17561, 36856)
    Asteroid():setPosition(-17561, 37127)
    Asteroid():setPosition(-14986, 40786)
    Asteroid():setPosition(-13360, 41328)
    Asteroid():setPosition(-11057, 40515)
    Asteroid():setPosition(-5908, 38076)
    Asteroid():setPosition(-3469, 36179)
    Asteroid():setPosition(-1978, 34417)
    Asteroid():setPosition(-7534, 37534)
    Asteroid():setPosition(-10379, 38753)
    Asteroid():setPosition(-11463, 36314)
    Asteroid():setPosition(-5366, 32385)
    Asteroid():setPosition(-6585, 38347)
    Asteroid():setPosition(-13225, 38211)
    Asteroid():setPosition(-9024, 34282)
    Asteroid():setPosition(-14309, 30488)
    Asteroid():setPosition(-9024, 35366)
    Asteroid():setPosition(-5637, 35908)
    Asteroid():setPosition(-1707, 32249)
    Asteroid():setPosition(461, 32385)
    Asteroid():setPosition(-3333, 21680)
    Asteroid():setPosition(3171, 18022)
    Asteroid():setPosition(6965, 16802)
    Asteroid():setPosition(2222, 19241)
    Asteroid():setPosition(2222, 25610)
    Asteroid():setPosition(2087, 25745)
    Asteroid():setPosition(-5230, 25610)
    Asteroid():setPosition(-5366, 25745)
    Asteroid():setPosition(-1843, 28320)
    Asteroid():setPosition(-3198, 29946)
    Asteroid():setPosition(-81, 29404)
    Asteroid():setPosition(-1843, 26965)
    Asteroid():setPosition(-2385, 25881)
    Asteroid():setPosition(461, 24661)
    Asteroid():setPosition(2493, 23577)
    Asteroid():setPosition(3984, 22222)
    Asteroid():setPosition(4526, 27236)
    Asteroid():setPosition(2087, 30759)
    Asteroid():setPosition(1951, 32249)
    Asteroid():setPosition(5610, 35366)
    Asteroid():setPosition(4119, 42547)
    Asteroid():setPosition(-352, 41328)
    Asteroid():setPosition(867, 38347)
    Asteroid():setPosition(9810, -14228)
    Asteroid():setPosition(9810, -14228)
    Asteroid():setPosition(3984, -14634)
    Asteroid():setPosition(10759, -10298)
    Asteroid():setPosition(14282, -8130)
    Asteroid():setPosition(9133, -8130)
    Asteroid():setPosition(5745, -9350)
    Asteroid():setPosition(6558, -11111)
    Asteroid():setPosition(8997, -8808)
    Asteroid():setPosition(10894, -7453)
    Asteroid():setPosition(14146, -6911)
    Asteroid():setPosition(17534, -6911)
    Asteroid():setPosition(18889, -8266)
    Asteroid():setPosition(15366, -10976)
    Asteroid():setPosition(13333, -11789)
    Asteroid():setPosition(10894, -13686)
    Asteroid():setPosition(7642, -16667)
    Asteroid():setPosition(5745, -18157)
    Asteroid():setPosition(7371, -20461)
    Asteroid():setPosition(10217, -18835)
    Asteroid():setPosition(12114, -14499)
    Asteroid():setPosition(16450, -11518)
    Asteroid():setPosition(21463, -9756)
    Asteroid():setPosition(19837, -14634)
    Asteroid():setPosition(15908, -16396)
    Asteroid():setPosition(13333, -17480)
    Asteroid():setPosition(12385, -20596)
    Asteroid():setPosition(14824, -20596)
    Asteroid():setPosition(18076, -15854)
    Asteroid():setPosition(21057, -14228)
    Asteroid():setPosition(22683, -12602)
    Asteroid():setPosition(18482, -11382)
    Asteroid():setPosition(14553, -18293)
    Asteroid():setPosition(22547, -17209)
    Asteroid():setPosition(21192, -13957)
    Asteroid():setPosition(19973, -18293)
    Asteroid():setPosition(11978, -23848)
    Asteroid():setPosition(7642, -22629)
    Asteroid():setPosition(5339, -18699)
    Asteroid():setPosition(2900, -15583)
    Asteroid():setPosition(-4011, -15989)
    Asteroid():setPosition(-6314, -19648)
    Asteroid():setPosition(54, -22222)
    Asteroid():setPosition(-3740, -30081)
    Asteroid():setPosition(-9566, -30488)
    Asteroid():setPosition(-8618, -23577)
    Asteroid():setPosition(-3604, -18564)
    Asteroid():setPosition(-2791, -25068)
    Asteroid():setPosition(-1301, -26016)
    Asteroid():setPosition(4390, -26965)
    Asteroid():setPosition(8726, -28591)
    Asteroid():setPosition(15095, -24390)
    Asteroid():setPosition(16856, -22629)
    Asteroid():setPosition(24444, -17751)
    Asteroid():setPosition(27832, -15583)
    Asteroid():setPosition(27967, -15854)
    Asteroid():setPosition(27561, -24390)
    Asteroid():setPosition(25935, -25339)
    Asteroid():setPosition(22818, -23171)
    Asteroid():setPosition(26206, -20190)
    Asteroid():setPosition(21192, -21951)
    Asteroid():setPosition(19160, -24255)
    Asteroid():setPosition(14417, -31301)
    Asteroid():setPosition(12520, -29946)
    Asteroid():setPosition(16992, -22222)
    Asteroid():setPosition(22141, -19919)
    Asteroid():setPosition(26612, -18157)
    Asteroid():setPosition(27154, -15041)
    Asteroid():setPosition(25528, -12602)
    Asteroid():setPosition(26748, -10976)
    Asteroid():setPosition(26748, -10298)
    Asteroid():setPosition(24851, -10163)
    Asteroid():setPosition(23496, -8401)
    Asteroid():setPosition(23089, -5149)
    Asteroid():setPosition(28645, -813)
    Asteroid():setPosition(30542, -4336)
    Asteroid():setPosition(28645, -7453)
    Asteroid():setPosition(27696, -8130)
    Asteroid():setPosition(29322, -9485)
    Asteroid():setPosition(32575, -8808)
    Asteroid():setPosition(35285, -8943)
    Asteroid():setPosition(30949, -16260)
    Asteroid():setPosition(29187, -13821)
    Asteroid():setPosition(31084, -12466)
    Asteroid():setPosition(33930, -12602)
    Asteroid():setPosition(32846, -17480)
    Asteroid():setPosition(30949, -18970)
    Asteroid():setPosition(29187, -19919)
    Asteroid():setPosition(30949, -25474)
    Asteroid():setPosition(32846, -24119)
    Asteroid():setPosition(34065, -21680)
    Asteroid():setPosition(34607, -18022)
    Asteroid():setPosition(39892, -14092)
    Asteroid():setPosition(41382, -22629)
    Asteroid():setPosition(46125, -17209)
    Asteroid():setPosition(46125, -16260)
    Asteroid():setPosition(49783, -8537)
    Asteroid():setPosition(48564, -6504)
    Asteroid():setPosition(45718, -8401)
    Asteroid():setPosition(42331, -12466)
    Asteroid():setPosition(41247, -13686)
    Asteroid():setPosition(45312, -13279)
    Asteroid():setPosition(-40461, 14634)
    Asteroid():setPosition(-43848, 12060)
    Asteroid():setPosition(-48591, 10163)
    Asteroid():setPosition(-48726, 10163)
    Asteroid():setPosition(-49404, 13821)
    Asteroid():setPosition(-48184, 15718)
    Asteroid():setPosition(-47642, 16531)
    Asteroid():setPosition(-41409, 15176)
    Asteroid():setPosition(-36938, 14092)
    Asteroid():setPosition(-35718, 12466)
    BlackHole():setPosition(-38157, -18970)
    BlackHole():setPosition(41111, 21951)
    Nebula():setPosition(23360, 10976)
    Nebula():setPosition(19431, 15583)
    Nebula():setPosition(13604, 15312)
    Nebula():setPosition(9810, 14228)
    Nebula():setPosition(-6992, -15718)
    Nebula():setPosition(-8211, -14363)
    Nebula():setPosition(-10921, -11247)
    Nebula():setPosition(-13902, -9079)
    Nebula():setPosition(-17967, -14363)
    Nebula():setPosition(-14173, -19106)
    Nebula():setPosition(16043, 9485)
    Nebula():setPosition(-10108, 33062)
    Nebula():setPosition(-17425, 35501)
    Nebula():setPosition(-25962, 35772)
    Nebula():setPosition(-32602, 31436)
    Nebula():setPosition(39621, -18428)
    Nebula():setPosition(33659, -23306)
    Nebula():setPosition(27290, -24797)
    Nebula():setPosition(31355, -19241)
    Nebula():setPosition(25257, -19648)
    Nebula():setPosition(-26504, 29946)
    Nebula():setPosition(58591, 3659)
    Nebula():setPosition(53984, -2304)
    Nebula():setPosition(47751, -6911)
    Nebula():setPosition(53306, 7453)
    Nebula():setPosition(-49675, -3388)
    Nebula():setPosition(-50081, 1220)
    Nebula():setPosition(-48997, 6098)
    Nebula():setPosition(-20000, 0)
    Nebula():setPosition(20000, 0)

    confSupply = SpaceStation():setTemplate("Huge Station"):setFaction("Confederation"):setCallSign("DE394"):setPosition(-100000, 0);
    rebelSupply = SpaceStation():setTemplate("Huge Station"):setFaction("Rebelle"):setCallSign("GK352"):setPosition(100000, 0);

    confStation = SpaceStation():setTemplate("Medium Station"):setFaction("Confederation"):setCallSign("Conf"):setPosition(irandom(-60000,-25000), irandom(-10000,30000));
    rebelStation = SpaceStation():setTemplate("Medium Station"):setFaction("Rebelle"):setCallSign("Rebel"):setPosition(irandom(25000,60000), irandom(-30000,10000));

    confShip1 = PlayerSpaceship():setFaction("Confederation"):setTemplate("Atlantis"):setCallSign("conf112"):setPosition(-100000,-2000);
    confShip2 = PlayerSpaceship():setFaction("Confederation"):setTemplate("Atlantis"):setCallSign("conf358"):setPosition(-100000,2000);

    rebelShip1 = PlayerSpaceship():setFaction("Rebelle"):setTemplate("Atlantis"):setCallSign("reb1321"):setPosition(100000,-2000);
    rebelShip2 = PlayerSpaceship():setFaction("Rebelle"):setTemplate("Atlantis"):setCallSign("reb3455"):setPosition(100000,2000);

    local confStationX, confStationY = confStation:getPosition();
    local rebelStationX, rebelStationY = rebelStation:getPosition();
    mobTeams = { { data = { amount = 10, minX = confStationX - 1000, maxX = confStationX + 1000, minY = confStationY - 1000, maxY = confStationY + 1000, faction = "Confederation" , timer = 0, maxTimer = 60 * 60 * 3}
                 , mobs = {}
                 }
               , { data = {amount = 10, minX = rebelStationX - 1000, maxX = rebelStationX + 1000, minY = rebelStationY - 1000, maxY =  rebelStationY + 1000, faction = "Rebelle", timer = 0, maxTimer = 60 * 60 * 3}
                 , mobs = {}
                 }
--               , { data = {amount = 10, minX = -41000, maxX = -39000, minY = -1000, maxY = 1000, faction = "Pirates", timer = 0, maxTimer = 60 * 60}
--                 , mobs = {}
--                 }
--               , { data = {amount = 10, minX = 39000, maxX = 41000, minY = -1000, maxY = 1000, faction = "Pirates", timer = 0, maxTimer = 60 * 60}
--                 , mobs = {}
--                 }
--               , { data = {amount = 10, minX = -30000, maxX = -28000, minY = 0, maxY = 2000, faction = "Pirates", timer = 0, maxTimer = 60 * 60}
--                 , mobs = {}
--                 }
               , { data = {amount = 10, minX = -15000, maxX = -13000, minY = 24000, maxY = 26000, faction = "Pirates", timer = 0, maxTimer = 60 * 60 * 3}
                 , mobs = {}
                 }
               , { data = {amount = 10, minX = -10000, maxX = -8000, minY = 7000, maxY = 9000, faction = "Pirates", timer = 0, maxTimer = 60 * 60 * 3}
                 , mobs = {}
                 }
               , { data = {amount = 10, minX = -9000, maxX = -7000, minY = -35000, maxY = -33000, faction = "Pirates", timer = 0, maxTimer = 60 * 60 * 3}
                 , mobs = {}
                 }

--               , { data = {amount = 10, minX = 28000, maxX = 30000, minY = -2000, maxY = 0, faction = "Pirates", timer = 0, maxTimer = 60 * 60}
--                 , mobs = {}
--                 }
               , { data = {amount = 10, minX = 13000, maxX = 15000, minY = -26000, maxY = -24000, faction = "Pirates", timer = 0, maxTimer = 60 * 60 * 3}
                 , mobs = {}
                 }
               , { data = {amount = 10, minX = 8000, maxX = 10000, minY = -9000, maxY = -7000, faction = "Pirates", timer = 0, maxTimer = 60 * 60 * 3}
                 , mobs = {}
                 }
               , { data = {amount = 10, minX = 7000, maxX = 9000, minY = 33000, maxY = 35000, faction = "Pirates", timer = 0, maxTimer = 60 * 60 * 3}
                 , mobs = {}
                 }
               };

    for index,team in ipairs(mobTeams) do
        team.mobs = generateMobTeam(team.data.amount, team.data.minX, team.data.maxX, team.data.minY, team.data.maxY, team.data.faction);
    end
end

function update(delta)
    for index,team in ipairs(mobTeams) do
        if team.data.timer == 0 then
            for index,mob in ipairs(team.mobs) do
                if not mob:isValid() then
                    team.mobs[index] = generateMobTeam(1, team.data.minX, team.data.maxX, team.data.minY, team.data.maxY, team.data.faction)[1];
                end
            end
            
            team.data.timer = team.data.maxTimer;

        end
        if team.data.faction == "Rebelle" and not shipInZone(confShip1, team.data.minX, team.data.maxX, team.data.minY, team.data.maxY) and not shipInZone(confShip2, team.data.minX, team.data.maxX, team.data.minY, team.data.maxY) then
            team.data.timer = team.data.timer - 1;
        end

        if team.data.faction == "Confederation" and not shipInZone(rebelShip1, team.data.minX, team.data.maxX, team.data.minY, team.data.maxY) and not shipInZone(rebelShip2, team.data.minX, team.data.maxX, team.data.minY, team.data.maxY) then
            team.data.timer = team.data.timer - 1;
        end

        if team.data.faction == "Pirates" and not shipInZone(rebelShip1, team.data.minX, team.data.maxX, team.data.minY, team.data.maxY) and not shipInZone(rebelShip2, team.data.minX, team.data.maxX, team.data.minY, team.data.maxY) and not shipInZone(confShip1, team.data.minX, team.data.maxX, team.data.minY, team.data.maxY) and not shipInZone(confShip2, team.data.minX, team.data.maxX, team.data.minY, team.data.maxY) then
            team.data.timer = team.data.timer - 1;
        end
        
    end

    if not confStation:isValid() then
        victory("Rebelle");
    end

    if not rebelStation:isValid() then
        victory("Confederation");
    end

    if not confShip1:isValid() then
        confShip1 = respawnConf();
    end
    if not confShip2:isValid() then
        confShip2 = respawnConf();
    end

    if not rebelShip1:isValid() then
        rebelShip1 = respawnRebel();
    end
    
    if not rebelShip2:isValid() then
        rebelShip2 = respawnRebel();
    end
end

function respawnConf()
    local ship = PlayerSpaceship():setFaction("Confederation"):setTemplate("Atlantis"):setCallSign("conf" .. irandom(100,999)):setPosition(irandom(-80000,-60000),irandom(-40000,40000));
    setRespawnAmmo(ship);
    return ship;
end

function respawnRebel()
    local ship = PlayerSpaceship():setFaction("Rebelle"):setTemplate("Atlantis"):setCallSign("reb" .. irandom(100,999)):setPosition(irandom(60000,80000),irandom(-40000,40000));
    setRespawnAmmo(ship);
    return ship;
end

function setRespawnAmmo(ship)
    ship:setWeaponStorage("Homing", 6)
    ship:setWeaponStorage("Nuke", 2)
    ship:setWeaponStorage("Mine", 4)
    ship:setWeaponStorage("EMP", 3)
    ship:setWeaponStorage("HVLI", 10)
end

function generateMobTeam(amount, minX, maxX, minY, maxY, faction)
    local ships = {};

    for i=1,amount,1 do
        ships[i] = CpuShip():setFaction(faction):setTemplate(randomType()):setCallSign(srandom(irandom(2,3)) .. irandom(10,999)):setPosition(irandom(minX, maxX), irandom(minY, maxY))
        ships[i]:orderStandGround();
    end

    return ships;
end

types = {};
for i=1,20,1 do
    table.insert(types,"MT52 Hornet");
end
--for i=10,11,1 do
    table.insert(types,"Atlantis X23");
--end

function randomType()
    return types[irandom(1,21)];
end

charset = {}
-- QWERTYUIOPASDFGHJKLZXCVBNM
for i = 65,  90 do table.insert(charset, string.char(i)) end

function srandom(length)
  if length > 0 then
    return srandom(length - 1) .. charset[irandom(1, #charset)]
  else
    return ""
  end
end

function shipInZone(ship, minX, maxX, minY, maxY)
    local x, y = ship:getPosition();
    return x > minX and x < maxX and y > minY and y < maxY
end
